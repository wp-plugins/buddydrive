window.bp=window.bp||{},function(e,i){"undefined"!=typeof BP_Uploader&&(bp.Models=bp.Models||{},bp.Collections=bp.Collections||{},bp.Views=bp.Views||{},bp.BuddyDrive={start:function(){this.views=new Backbone.Collection,this.warning=null,this.uploaderView(),this.buddyfiles=bp.Uploader.filesUploaded},uploaderView:function(){bp.Uploader.filesQueue.on("add",this.uploadProgress,this);var e=new bp.Views.Uploader;this.views.add({id:"upload",view:e}),e.inject(".buddydrive-uploader")},uploadProgress:function(){var e=new bp.Views.uploadBuddyfileStatus({collection:bp.Uploader.filesQueue});_.isUndefined(this.views.get("status"))?this.views.add({id:"status",view:e}):this.views.set({id:"status",view:e}),e.inject(".buddydrive-uploader-status")}},bp.Views.uploadBuddyfileStatus=bp.Views.uploaderStatus.extend({className:"files",events:{"click .bd-insert":"sendtoEditor"},initialize:function(){bp.Views.uploaderStatus.prototype.initialize.apply(this,arguments),this.collection.on("change:url",this.updateEntry,this)},updateEntry:function(e){var t=BP_Uploader.strings.buddydrive_insert;_.isUndefined(e.get("icon"))||i("#"+e.get("id")+" .filename img").length||(i("#"+e.get("id")+" .filename").prepend('<img src="'+e.get("icon")+'"> '),i("#"+e.get("id")+" .bp-progress").addClass("bd-success"),i("#"+e.get("id")+" .bp-progress").html('<a href="#" class="bd-insert button" data-fileurl="'+e.get("url")+'">'+t+"</a>"))},sendtoEditor:function(e){var t,d=null,s="undefined"!=typeof tinymce,n="undefined"!=typeof QTags;if(e.preventDefault(),d=i(e.target).data("fileurl"),_.isUndefined(BP_Uploader.strings.buddydrive_editor_id)){if(_.isUndefined(window.wpActiveEditor)){if(s&&tinymce.activeEditor)t=tinymce.activeEditor,wpActiveEditor=t.id;else if(!n)return!1}else s&&(t=tinymce.get(window.wpActiveEditor));t&&!t.isHidden()?t.execCommand("mceInsertContent",!1,d):n?QTags.insertContent(d):window.wpActiveEditor&&(i(window.wpActiveEditor).value+=d)}else t=BP_Uploader.strings.buddydrive_editor_id,0===i("#"+t).val().length?i("#"+t).val(d+"\n").focus():i("#"+t).val(i("#"+t).val()+"\n"+d).focus();if(window.tb_remove)try{window.tb_remove()}catch(o){}}}),bp.BuddyDrive.start())}(bp,jQuery);
